---
- name: "ensure we have write access on maintenance trigger directory"
  shell: |
         set -e
         chmod 2775 "{{cops_drupal_vars.data_root}}/var/sites/default"
  become: true
  become_user: "{{cops_drupal_vars.user}}"
- name: "remove cron suspension (removal lock file) & nginx MAINTENANCE marker"
  file:
    state: absent
    path: "{{item}}"
  become: true
  become_user: "{{cops_drupal_vars.user}}"
  with_items:
    - "{{cops_drupal_vars.project_root}}/var/tmp/run_cron.lock"
    - "{{cops_drupal_vars.project_root}}/www/sites/default/MAINTENANCE"
- name: "remove MAINTENANCE mode and wait some seconds for open_file_cache to detect file trigger removal"
  pause:
    seconds: "{{vars['cops_drupal_maintenance_trigger_seconds']}}"
- name: "redo the special rights on maintenance trigger directory"
  shell: |
         set -e
         chmod 2555 "{{cops_drupal_vars.data_root}}/var/sites/default"
  become: true
  become_user: "{{cops_drupal_vars.user}}"
